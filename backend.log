INFO:     Will watch for changes in these directories: ['/Users/shrishesha/Developer/temp/demand_prediction/be']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [85443] using WatchFiles
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):
INFO:main:CORS allowed origins: ['http://localhost:5173', 'http://localhost:3000', 'http://localhost:8080', 'https://pdp.shrishesha.space']
INFO:     Started server process [85447]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:51128 - "GET /health HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'core/forecast_pipeline.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [85447]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):
INFO:main:CORS allowed origins: ['http://localhost:5173', 'http://localhost:3000', 'http://localhost:8080', 'https://pdp.shrishesha.space']
INFO:     Started server process [86447]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:main:Loaded LSTM model for future forecasting
/Users/shrishesha/Developer/temp/demand_prediction/be/main.py:330: DtypeWarning: Columns (23) have mixed types. Specify dtype option on import or set low_memory=False.
  raw_df = pd.read_csv(data_path)
ERROR:main:Future forecast failed: 'date'
Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/main.py", line 331, in forecast_future
    raw_df['date'] = pd.to_datetime(raw_df['date'])
                                    ~~~~~~^^^^^^^^
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/pandas/core/frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'date'
INFO:     192.0.0.2:51670 - "POST /forecast_future HTTP/1.1" 500 Internal Server Error
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [86447]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):
INFO:main:CORS allowed origins: ['http://localhost:5173', 'http://localhost:3000', 'http://localhost:8080', 'https://pdp.shrishesha.space']
INFO:     Started server process [86665]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:main:Loaded LSTM model for future forecasting
/Users/shrishesha/Developer/temp/demand_prediction/be/main.py:362: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  raw_df['date'] = pd.to_datetime(raw_df['date'])
INFO:main:Found 7195 SKUs in data
/Users/shrishesha/Developer/temp/demand_prediction/be/core/forecast_pipeline.py:61: DtypeWarning: Columns (23) have mixed types. Specify dtype option on import or set low_memory=False.
  df = pd.read_csv(csv_path)
/Users/shrishesha/Developer/temp/demand_prediction/be/core/forecast_pipeline.py:127: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  df['date'] = pd.to_datetime(df['date'])
INFO:main:Padded 1278 days to historical data so forecasts start today (2025-12-29)
INFO:main:seed_data sample for forecasting (last rows):
            total_units  avg_price  promo_any  ...   dow_cos   doy_sin   doy_cos
date                                           ...                              
2025-12-24          627      100.0          0  ... -0.222521 -0.124395  0.992233
2025-12-25          627      100.0          0  ... -0.900969 -0.107308  0.994226
2025-12-26          627      100.0          0  ... -0.900969 -0.090190  0.995925
2025-12-27          627      100.0          0  ... -0.222521 -0.073045  0.997329
2025-12-28          627      100.0          0  ...  0.623490 -0.055879  0.998438

[5 rows x 8 columns]
INFO:main:seed_data has 30 rows, expected N_IN=30
INFO:main:predict_future_with_lstm: seed_data rows=30, n_in=30, forecast_days=364
INFO:main:predict_future_with_lstm: seed_data columns=['total_units', 'avg_price', 'promo_any', 'dow', 'dow_sin', 'dow_cos', 'doy_sin', 'doy_cos']
INFO:main:predict_future_with_lstm: seed_data index dtype=datetime64[ns]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/sklearn/utils/validation.py:2684: UserWarning: X has feature names, but MinMaxScaler was fitted without feature names
  warnings.warn(
INFO:main:Generated 364 future predictions
INFO:main:Generated 364 days of future forecasts for 7195 SKUs using LSTM
INFO:main:Forecast sample (first 8 days):
      date  predicted_units         ma7        ma14
2025-12-29      1073.355194  966.310307 1001.089555
2025-12-30      1017.651064  957.800084 1027.030019
2025-12-31       915.092430  974.394717 1039.740685
2026-01-01       859.142539 1001.089555 1038.558098
2026-01-02       923.759191 1020.412137 1032.330820
2026-01-03      1057.367887 1038.094272 1033.447821
2026-01-04      1161.258578 1054.211756 1045.318537
2026-01-05      1208.613269 1070.056828 1063.088814
INFO:     192.0.0.2:51739 - "POST /forecast_future HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'main.py', 'core/forecast_pipeline.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [86665]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):
INFO:main:CORS allowed origins: ['http://localhost:5173', 'http://localhost:3000', 'http://localhost:8080', 'https://pdp.shrishesha.space']
INFO:     Started server process [86964]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [86964]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):
INFO:main:CORS allowed origins: ['http://localhost:5173', 'http://localhost:3000', 'http://localhost:8080', 'https://pdp.shrishesha.space']
INFO:     Started server process [87105]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [87105]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):
INFO:main:CORS allowed origins: ['http://localhost:5173', 'http://localhost:3000', 'http://localhost:8080', 'https://pdp.shrishesha.space']
INFO:     Started server process [87258]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:main:Loaded LSTM model for future forecasting
/Users/shrishesha/Developer/temp/demand_prediction/be/main.py:362: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  raw_df['date'] = pd.to_datetime(raw_df['date'])
INFO:main:Found 7195 SKUs in data
/Users/shrishesha/Developer/temp/demand_prediction/be/core/forecast_pipeline.py:61: DtypeWarning: Columns (23) have mixed types. Specify dtype option on import or set low_memory=False.
  df = pd.read_csv(csv_path)
/Users/shrishesha/Developer/temp/demand_prediction/be/core/forecast_pipeline.py:127: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  df['date'] = pd.to_datetime(df['date'])
INFO:main:Padded 1278 days to historical data so forecasts start today (2025-12-29)
INFO:main:seed_data sample for forecasting (last rows):
            total_units  avg_price  promo_any  ...   dow_cos   doy_sin   doy_cos
date                                           ...                              
2025-12-24          627      100.0          0  ... -0.222521 -0.124395  0.992233
2025-12-25          627      100.0          0  ... -0.900969 -0.107308  0.994226
2025-12-26          627      100.0          0  ... -0.900969 -0.090190  0.995925
2025-12-27          627      100.0          0  ... -0.222521 -0.073045  0.997329
2025-12-28          627      100.0          0  ...  0.623490 -0.055879  0.998438

[5 rows x 8 columns]
INFO:main:seed_data has 30 rows, expected N_IN=30
INFO:main:predict_future_with_lstm: seed_data rows=30, n_in=30, forecast_days=364
INFO:main:predict_future_with_lstm: seed_data columns=['total_units', 'avg_price', 'promo_any', 'dow', 'dow_sin', 'dow_cos', 'doy_sin', 'doy_cos']
INFO:main:predict_future_with_lstm: seed_data index dtype=datetime64[ns]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/sklearn/utils/validation.py:2684: UserWarning: X has feature names, but MinMaxScaler was fitted without feature names
  warnings.warn(
INFO:main:Generated 364 future predictions
INFO:main:Generated 364 days of future forecasts for 7195 SKUs using LSTM
INFO:main:Forecast sample (first 8 days):
      date  predicted_units         ma7        ma14
2025-12-29      1073.355194  966.310307 1001.089555
2025-12-30      1017.651064  957.800084 1027.030019
2025-12-31       915.092430  974.394717 1039.740685
2026-01-01       859.142539 1001.089555 1038.558098
2026-01-02       923.759191 1020.412137 1032.330820
2026-01-03      1057.367887 1038.094272 1033.447821
2026-01-04      1161.258578 1054.211756 1045.318537
2026-01-05      1208.613269 1070.056828 1063.088814
INFO:     192.0.0.2:51932 - "POST /forecast_future HTTP/1.1" 200 OK
INFO:main:Loaded LSTM model for future forecasting
ERROR:main:Future forecast failed: Missing 'date' column. Found columns: ['index', 'sku code', 'design no.', 'stock', 'category', 'size', 'color']
Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/main.py", line 350, in forecast_future
    raise ValueError(f"Missing 'date' column. Found columns: {list(raw_df.columns)}")
ValueError: Missing 'date' column. Found columns: ['index', 'sku code', 'design no.', 'stock', 'category', 'size', 'color']
INFO:     192.0.0.2:51961 - "POST /forecast_future HTTP/1.1" 500 Internal Server Error
INFO:main:Loaded LSTM model for future forecasting
ERROR:main:Future forecast failed: Missing 'date' column. Found columns: ['index', 'sku_id', 'style id', 'catalog', 'category', 'weight', 'tp 1', 'tp 2', 'mrp old', 'final mrp old', 'ajio mrp', 'amazon mrp', 'amazon fba mrp', 'flipkart mrp', 'limeroad mrp', 'myntra mrp', 'paytm mrp', 'snapdeal mrp']
Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/main.py", line 350, in forecast_future
    raise ValueError(f"Missing 'date' column. Found columns: {list(raw_df.columns)}")
ValueError: Missing 'date' column. Found columns: ['index', 'sku_id', 'style id', 'catalog', 'category', 'weight', 'tp 1', 'tp 2', 'mrp old', 'final mrp old', 'ajio mrp', 'amazon mrp', 'amazon fba mrp', 'flipkart mrp', 'limeroad mrp', 'myntra mrp', 'paytm mrp', 'snapdeal mrp']
INFO:     192.0.0.2:51962 - "POST /forecast_future HTTP/1.1" 500 Internal Server Error
INFO:main:Loaded LSTM model for future forecasting
ERROR:main:Future forecast failed: Missing 'units_sold' column. Found columns: ['index', 'date', 'months', 'customer', 'style', 'sku_id', 'size', 'pcs', 'rate', 'gross amt']
Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/main.py", line 352, in forecast_future
    raise ValueError(f"Missing 'units_sold' column. Found columns: {list(raw_df.columns)}")
ValueError: Missing 'units_sold' column. Found columns: ['index', 'date', 'months', 'customer', 'style', 'sku_id', 'size', 'pcs', 'rate', 'gross amt']
INFO:     192.0.0.2:51963 - "POST /forecast_future HTTP/1.1" 500 Internal Server Error
INFO:main:Loaded LSTM model for future forecasting
ERROR:main:Future forecast failed: Missing 'date' column. Found columns: ['index', 'recived amount', 'unnamed: 1', 'expance', 'unnamed: 3']
Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/main.py", line 350, in forecast_future
    raise ValueError(f"Missing 'date' column. Found columns: {list(raw_df.columns)}")
ValueError: Missing 'date' column. Found columns: ['index', 'recived amount', 'unnamed: 1', 'expance', 'unnamed: 3']
INFO:     192.0.0.2:51964 - "POST /forecast_future HTTP/1.1" 500 Internal Server Error
INFO:main:Loaded LSTM model for future forecasting
ERROR:main:Future forecast failed: Missing 'date' column. Found columns: ['index', 'shiprocket', 'unnamed: 1', 'increff']
Traceback (most recent call last):
  File "/Users/shrishesha/Developer/temp/demand_prediction/be/main.py", line 350, in forecast_future
    raise ValueError(f"Missing 'date' column. Found columns: {list(raw_df.columns)}")
ValueError: Missing 'date' column. Found columns: ['index', 'shiprocket', 'unnamed: 1', 'increff']
INFO:     192.0.0.2:51965 - "POST /forecast_future HTTP/1.1" 500 Internal Server Error
INFO:main:Loaded LSTM model for future forecasting
INFO:main:Found 3 SKUs in data
INFO:main:Padded 362 days to historical data so forecasts start today (2025-12-29)
INFO:main:seed_data sample for forecasting (last rows):
            total_units     avg_price  promo_any  ...   dow_cos   doy_sin   doy_cos
date                                              ...                              
2025-12-24         1813  244879.08428          0  ... -0.222521 -0.124395  0.992233
2025-12-25         1813  244879.08428          0  ... -0.900969 -0.107308  0.994226
2025-12-26         1813  244879.08428          0  ... -0.900969 -0.090190  0.995925
2025-12-27         1813  244879.08428          0  ... -0.222521 -0.073045  0.997329
2025-12-28         1813  244879.08428          0  ...  0.623490 -0.055879  0.998438

[5 rows x 8 columns]
INFO:main:seed_data has 30 rows, expected N_IN=30
INFO:main:predict_future_with_lstm: seed_data rows=30, n_in=30, forecast_days=364
INFO:main:predict_future_with_lstm: seed_data columns=['total_units', 'avg_price', 'promo_any', 'dow', 'dow_sin', 'dow_cos', 'doy_sin', 'doy_cos']
INFO:main:predict_future_with_lstm: seed_data index dtype=datetime64[ns]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/sklearn/utils/validation.py:2684: UserWarning: X has feature names, but MinMaxScaler was fitted without feature names
  warnings.warn(
INFO:main:Generated 364 future predictions
INFO:main:Generated 364 days of future forecasts for 3 SKUs using LSTM
INFO:main:Forecast sample (first 8 days):
      date  predicted_units         ma7        ma14
2025-12-29      1409.087713 1153.226295 1127.704336
2025-12-30      1283.091273 1104.592596 1155.030056
2025-12-31      1040.671597 1103.716051 1164.137585
2026-01-01       880.054598 1127.704336 1144.969339
2026-01-02       910.057800 1118.736105 1114.081994
2026-01-03      1099.333325 1112.151326 1090.740780
2026-01-04      1271.634049 1102.406116 1085.941120
2026-01-05      1346.310092 1091.713822 1094.484520
INFO:     192.0.0.2:51976 - "POST /forecast_future HTTP/1.1" 200 OK
INFO:main:Loaded LSTM model for future forecasting
INFO:main:Found 3 SKUs in data
INFO:main:Padded 362 days to historical data so forecasts start today (2025-12-29)
INFO:main:seed_data sample for forecasting (last rows):
            total_units     avg_price  promo_any  ...   dow_cos   doy_sin   doy_cos
date                                              ...                              
2025-12-24         1813  244879.08428          0  ... -0.222521 -0.124395  0.992233
2025-12-25         1813  244879.08428          0  ... -0.900969 -0.107308  0.994226
2025-12-26         1813  244879.08428          0  ... -0.900969 -0.090190  0.995925
2025-12-27         1813  244879.08428          0  ... -0.222521 -0.073045  0.997329
2025-12-28         1813  244879.08428          0  ...  0.623490 -0.055879  0.998438

[5 rows x 8 columns]
INFO:main:seed_data has 30 rows, expected N_IN=30
INFO:main:predict_future_with_lstm: seed_data rows=30, n_in=30, forecast_days=364
INFO:main:predict_future_with_lstm: seed_data columns=['total_units', 'avg_price', 'promo_any', 'dow', 'dow_sin', 'dow_cos', 'doy_sin', 'doy_cos']
INFO:main:predict_future_with_lstm: seed_data index dtype=datetime64[ns]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/sklearn/utils/validation.py:2684: UserWarning: X has feature names, but MinMaxScaler was fitted without feature names
  warnings.warn(
INFO:main:Generated 364 future predictions
INFO:main:Generated 364 days of future forecasts for 3 SKUs using LSTM
INFO:main:Forecast sample (first 8 days):
      date  predicted_units         ma7        ma14
2025-12-29      1409.087713 1153.226295 1127.704336
2025-12-30      1283.091273 1104.592596 1155.030056
2025-12-31      1040.671597 1103.716051 1164.137585
2026-01-01       880.054598 1127.704336 1144.969339
2026-01-02       910.057800 1118.736105 1114.081994
2026-01-03      1099.333325 1112.151326 1090.740780
2026-01-04      1271.634049 1102.406116 1085.941120
2026-01-05      1346.310092 1091.713822 1094.484520
INFO:     192.0.0.2:52074 - "POST /forecast_future HTTP/1.1" 200 OK
INFO:main:Loaded LSTM model for future forecasting
INFO:main:Found 3 SKUs in data
INFO:main:Padded 362 days to historical data so forecasts start today (2025-12-29)
INFO:main:seed_data sample for forecasting (last rows):
            total_units      avg_price  promo_any  ...   dow_cos   doy_sin   doy_cos
date                                               ...                              
2025-12-24         1575  221502.027102          0  ... -0.222521 -0.124395  0.992233
2025-12-25         1575  221502.027102          0  ... -0.900969 -0.107308  0.994226
2025-12-26         1575  221502.027102          0  ... -0.900969 -0.090190  0.995925
2025-12-27         1575  221502.027102          0  ... -0.222521 -0.073045  0.997329
2025-12-28         1575  221502.027102          0  ...  0.623490 -0.055879  0.998438

[5 rows x 8 columns]
INFO:main:seed_data has 30 rows, expected N_IN=30
INFO:main:predict_future_with_lstm: seed_data rows=30, n_in=30, forecast_days=364
INFO:main:predict_future_with_lstm: seed_data columns=['total_units', 'avg_price', 'promo_any', 'dow', 'dow_sin', 'dow_cos', 'doy_sin', 'doy_cos']
INFO:main:predict_future_with_lstm: seed_data index dtype=datetime64[ns]
/Users/shrishesha/Developer/temp/demand_prediction/be/.venv/lib/python3.11/site-packages/sklearn/utils/validation.py:2684: UserWarning: X has feature names, but MinMaxScaler was fitted without feature names
  warnings.warn(
INFO:main:Generated 364 future predictions
INFO:main:Generated 364 days of future forecasts for 3 SKUs using LSTM
INFO:main:Forecast sample (first 8 days):
      date  predicted_units         ma7        ma14
2025-12-29      1383.989712 1148.031517 1130.861310
2025-12-30      1266.765159 1104.036786 1159.097573
2025-12-31      1045.433239 1105.876270 1169.561264
2026-01-01       895.937958 1130.861310 1154.150549
2026-01-02       928.057860 1126.970125 1127.582635
2026-01-03      1115.073693 1125.042358 1108.176812
2026-01-04      1280.771547 1120.759625 1105.893111
2026-01-05      1356.751419 1115.897559 1116.194098
INFO:     192.0.0.2:54046 - "POST /forecast_future HTTP/1.1" 200 OK
INFO:main:Found 3 SKUs in data
INFO:main:Padded 362 days to historical data so forecasts start today (2025-12-29)
INFO:main:Generated 364 days of future forecasts for 3 SKUs using SARIMAX
INFO:main:Forecast sample (first 8 days):
      date  predicted_units         ma7        ma14
2025-12-29      1575.104394 1575.009249 1575.006426
2025-12-30      1575.055177 1574.990714 1575.020074
2025-12-31      1574.995016 1574.992297 1575.024380
2026-01-01      1574.882411 1575.006426 1575.021747
2026-01-02      1574.916574 1575.008028 1575.009362
2026-01-03      1575.000213 1575.008549 1575.001897
2026-01-04      1575.091195 1575.008984 1575.002022
2026-01-05      1575.115612 1575.009426 1575.008635
INFO:     192.0.0.2:54054 - "POST /forecast_future HTTP/1.1" 200 OK
